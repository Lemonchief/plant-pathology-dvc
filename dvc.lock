schema: '2.0'
stages:
  prepare:
    cmd: python -m src.prepare_data --out data/raw --val-size 0.1 --seed 42
    deps:
    - path: src/prepare_data.py
      hash: md5
      md5: c574383f1763ac50de58cce2448cd52e
      size: 1697
    outs:
    - path: data/raw
      hash: md5
      md5: c32e14049e5f85d24cf6c8ecf80a0436.dir
      size: 121555795
      nfiles: 70008
  augment:
    cmd: python -m src.augment_data --in data/raw --out data/augmented 
      --n-per-image 2 --max-per-class 6000 --seed 42
    deps:
    - path: data/raw
      hash: md5
      md5: c32e14049e5f85d24cf6c8ecf80a0436.dir
      size: 121555795
      nfiles: 70008
    - path: src/augment_data.py
      hash: md5
      md5: faa860ca37af5c7aac94b87da4881c69
      size: 2038
    outs:
    - path: data/augmented
      hash: md5
      md5: a054c95070a1ffd095acb2987c3b560e.dir
      size: 88339949
      nfiles: 178000
  stats:
    cmd: python -m src.compute_stats --data data/raw --out artifacts/stats.json
    deps:
    - path: data/raw
      hash: md5
      md5: c32e14049e5f85d24cf6c8ecf80a0436.dir
      size: 121555795
      nfiles: 70008
    - path: src/compute_stats.py
      hash: md5
      md5: d915c5231f2850776ee9e8e1c69c6c0d
      size: 988
    outs:
    - path: artifacts/stats.json
      hash: md5
      md5: 963ca486204491d7f8d00a943d17364a
      size: 62
  train:
    cmd: python -m src.train --data data/raw --stats artifacts/stats.json 
      --model resnet18 --epochs 1 --lr 0.01 --batch-size 64 --weight-decay 0.0 
      --seed 42
    deps:
    - path: artifacts/stats.json
      hash: md5
      md5: 963ca486204491d7f8d00a943d17364a
      size: 62
    - path: data/raw
      hash: md5
      md5: c32e14049e5f85d24cf6c8ecf80a0436.dir
      size: 121555795
      nfiles: 70008
    - path: src/models.py
      hash: md5
      md5: 24738db6e2e030abfd85a61df9a7ac3f
      size: 1200
    - path: src/train.py
      hash: md5
      md5: 8d11579ab22f605b0e8a03226ab6e97a
      size: 3384
    - path: src/utils.py
      hash: md5
      md5: ccb5a09206dda31874f245851e588585
      size: 2137
    outs:
    - path: metrics/train.json
      hash: md5
      md5: 5bac293cfca0e860ec4b8d4e446416fb
      size: 101
    - path: models/model.pt
      hash: md5
      md5: 85fb1924e88c95438e02f2ac565141f9
      size: 44797323
  evaluate:
    cmd: python -m src.evaluate --data data/raw --stats artifacts/stats.json 
      --model-path models/model.pt --out metrics/eval.json --cm 
      plots/confusion_matrix.csv
    deps:
    - path: artifacts/stats.json
      hash: md5
      md5: 963ca486204491d7f8d00a943d17364a
      size: 62
    - path: data/raw
      hash: md5
      md5: c32e14049e5f85d24cf6c8ecf80a0436.dir
      size: 121555795
      nfiles: 70008
    - path: metrics/train.json
      hash: md5
      md5: 5bac293cfca0e860ec4b8d4e446416fb
      size: 101
    - path: models/model.pt
      hash: md5
      md5: 85fb1924e88c95438e02f2ac565141f9
      size: 44797323
    - path: src/evaluate.py
      hash: md5
      md5: ea1ecb44f4260168fddec964c8d17f1e
      size: 1787
    - path: src/models.py
      hash: md5
      md5: 24738db6e2e030abfd85a61df9a7ac3f
      size: 1200
    - path: src/utils.py
      hash: md5
      md5: ccb5a09206dda31874f245851e588585
      size: 2137
    outs:
    - path: metrics/eval.json
      hash: md5
      md5: c8e51cd2a8af7662928802654cca852e
      size: 51
    - path: plots/confusion_matrix.csv
      hash: md5
      md5: a1e6977cf44d5cd6259ec5092f72f400
      size: 252
