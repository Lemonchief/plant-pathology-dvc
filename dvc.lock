schema: '2.0'
stages:
  prepare:
    cmd: python -m src.prepare_data --out data/raw --val-size 0.1 --seed 42
    deps:
    - path: src/prepare_data.py
      hash: md5
      md5: b4f9952466f2db3ec0cc9a7a7be0670b
      size: 1971
    outs:
    - path: data/raw
      hash: md5
      md5: 94918bb22daaae2ed11ccf43446191fd.dir
      size: 823687857
      nfiles: 3642
  augment:
    cmd: python -m src.augment_data --in data/raw --out data/augmented 
      --n-per-image 2 --max-per-class 6000 --seed 42
    deps:
    - path: data/raw
      hash: md5
      md5: 94918bb22daaae2ed11ccf43446191fd.dir
      size: 823687857
      nfiles: 3642
    - path: src/augment_data.py
      hash: md5
      md5: 3fef7e9bcf31865210ed1d60bd2084d4
      size: 2419
    outs:
    - path: data/augmented
      hash: md5
      md5: 5921ca37ca4c6debf9a11c264f21afe5.dir
      size: 1319470949
      nfiles: 6554
  stats:
    cmd: python -m src.compute_stats --data data/augmented --out 
      artifacts/stats.json
    deps:
    - path: data/augmented
      hash: md5
      md5: 5921ca37ca4c6debf9a11c264f21afe5.dir
      size: 1319470949
      nfiles: 6554
    - path: src/compute_stats.py
      hash: md5
      md5: 0434380bef1e2f74d36e838e46a938c6
      size: 1021
    outs:
    - path: artifacts/stats.json
      hash: md5
      md5: a9af73603f3a7f4aef6df5e66be0685c
      size: 66
  train:
    cmd: python -m src.train --data data/augmented --stats artifacts/stats.json 
      --model resnet18 --epochs 1 --lr 0.01 --batch-size 64 --weight-decay 0.0 
      --seed 42
    deps:
    - path: artifacts/stats.json
      hash: md5
      md5: a9af73603f3a7f4aef6df5e66be0685c
      size: 66
    - path: data/augmented
      hash: md5
      md5: 5921ca37ca4c6debf9a11c264f21afe5.dir
      size: 1319470949
      nfiles: 6554
    - path: src/models.py
      hash: md5
      md5: 5b1887059bd2757c3296a57d6793b08d
      size: 1228
    - path: src/train.py
      hash: md5
      md5: 998b95a7b261ee74f0fc4c9aa7156abc
      size: 3475
    - path: src/utils.py
      hash: md5
      md5: b59bb8c7bd9525a0679c0a003fe9bc96
      size: 1997
    outs:
    - path: metrics/train.json
      hash: md5
      md5: b7e2813e34b885f1819c84f461877579
      size: 107
    - path: models/model.pt
      hash: md5
      md5: 586b25ee08f842104e843292e1abd3e1
      size: 44785035
  evaluate:
    cmd: python -m src.evaluate --data data/augmented --stats 
      artifacts/stats.json --model-path models/model.pt --out metrics/eval.json 
      --cm plots/confusion_matrix.csv
    deps:
    - path: artifacts/stats.json
      hash: md5
      md5: a9af73603f3a7f4aef6df5e66be0685c
      size: 66
    - path: data/augmented
      hash: md5
      md5: 5921ca37ca4c6debf9a11c264f21afe5.dir
      size: 1319470949
      nfiles: 6554
    - path: metrics/train.json
      hash: md5
      md5: b7e2813e34b885f1819c84f461877579
      size: 107
    - path: models/model.pt
      hash: md5
      md5: 586b25ee08f842104e843292e1abd3e1
      size: 44785035
    - path: src/evaluate.py
      hash: md5
      md5: 9b5a1dfcccc62a73e6ddad5630dc5caf
      size: 1838
    - path: src/models.py
      hash: md5
      md5: 5b1887059bd2757c3296a57d6793b08d
      size: 1228
    - path: src/utils.py
      hash: md5
      md5: b59bb8c7bd9525a0679c0a003fe9bc96
      size: 1997
    outs:
    - path: metrics/eval.json
      hash: md5
      md5: 27f6be6a007c70ab7e94ca6bf30430e2
      size: 48
    - path: plots/confusion_matrix.csv
      hash: md5
      md5: 3a87f550da799e5c5a6519b993016a83
      size: 13
